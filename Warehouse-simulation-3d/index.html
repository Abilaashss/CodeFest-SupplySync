<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warehouse Optimization</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }
        canvas {
            display: block;
        }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-family: Arial, sans-serif;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
        }
    </style>
    <!-- Three.js and required libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.7/dat.gui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>
</head>
<body>
    <div id="info">Warehouse Optimization Simulator</div>
    <script>
        class WarehouseSimulation {
            constructor() {
                // Scene setup
                this.scene = new THREE.Scene();
                this.camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                this.renderer = new THREE.WebGLRenderer({ antialias: true });
                this.renderer.setSize(window.innerWidth, window.innerHeight);
                document.body.appendChild(this.renderer.domElement);

                // Camera position
                this.camera.position.set(15, 15, 15);
                this.camera.lookAt(0, 0, 0);

                // Lighting
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
                this.scene.add(ambientLight);
                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
                directionalLight.position.set(10, 10, 10);
                this.scene.add(directionalLight);

                // Controls setup
                this.controls = new THREE.OrbitControls(this.camera, this.renderer.domElement);

                // Warehouse properties
                this.warehouse = this.createWarehouse();
                this.shelves = this.createShelves();
                this.truck = this.createTruck();
                
                // Product types and their properties
                this.products = {
                    'wheel': { color: 0x444444, size: 1 },
                    'door': { color: 0x666666, size: 2 },
                    'headlight': { color: 0xcccccc, size: 0.5 }
                };

                // Storage management
                this.inventory = new Map();
                this.currentProductType = 'wheel';
                this.selectedShelf = 0;
                
                // GUI setup
                this.setupGUI();
                
                // Start animation loop
                this.animate();
            }

            createWarehouse() {
                const warehouse = new THREE.Group();
                
                // Floor
                const floorGeometry = new THREE.PlaneGeometry(30, 20);
                const floorMaterial = new THREE.MeshStandardMaterial({ color: 0x808080 });
                const floor = new THREE.Mesh(floorGeometry, floorMaterial);
                floor.rotation.x = -Math.PI / 2;
                warehouse.add(floor);

                // Walls
                const wallMaterial = new THREE.MeshStandardMaterial({ color: 0xcccccc });
                const wallGeometry = new THREE.BoxGeometry(30, 10, 0.2);
                
                const backWall = new THREE.Mesh(wallGeometry, wallMaterial);
                backWall.position.set(0, 5, -10);
                warehouse.add(backWall);

                const sideWall1 = new THREE.Mesh(wallGeometry, wallMaterial);
                sideWall1.rotation.y = Math.PI / 2;
                sideWall1.position.set(-15, 5, 0);
                warehouse.add(sideWall1);

                const sideWall2 = new THREE.Mesh(wallGeometry, wallMaterial);
                sideWall2.rotation.y = Math.PI / 2;
                sideWall2.position.set(15, 5, 0);
                warehouse.add(sideWall2);

                this.scene.add(warehouse);
                return warehouse;
            }

            createShelves() {
                const shelvesGroup = new THREE.Group();
                
                // Create multiple shelf units
                for (let i = 0; i < 3; i++) {
                    const shelfUnit = this.createShelfUnit();
                    shelfUnit.position.set(-10 + i * 10, 0, -8);
                    shelvesGroup.add(shelfUnit);
                }

                this.scene.add(shelvesGroup);
                return shelvesGroup;
            }

            createShelfUnit() {
                const shelfUnit = new THREE.Group();
                const shelfMaterial = new THREE.MeshStandardMaterial({ color: 0x8B4513 });

                // Create vertical supports
                const supportGeometry = new THREE.BoxGeometry(0.2, 8, 0.2);
                for (let i = 0; i < 4; i++) {
                    const support = new THREE.Mesh(supportGeometry, shelfMaterial);
                    support.position.set(i < 2 ? -1 : 1, 4, i % 2 ? -1 : 1);
                    shelfUnit.add(support);
                }

                // Create horizontal shelves
                const shelfGeometry = new THREE.BoxGeometry(2.2, 0.2, 2.2);
                for (let i = 0; i < 4; i++) {
                    const shelf = new THREE.Mesh(shelfGeometry, shelfMaterial);
                    shelf.position.set(0, i * 2.5, 0);
                    shelfUnit.add(shelf);
                }

                return shelfUnit;
            }

            createTruck() {
                const truck = new THREE.Group();

                // Truck body
                const bodyGeometry = new THREE.BoxGeometry(4, 3, 6);
                const bodyMaterial = new THREE.MeshStandardMaterial({ color: 0x2244cc });
                const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
                body.position.y = 2;
                truck.add(body);

                // Cab
                const cabGeometry = new THREE.BoxGeometry(4, 2, 2);
                const cab = new THREE.Mesh(cabGeometry, bodyMaterial);
                cab.position.set(0, 2.5, -4);
                truck.add(cab);

                // Wheels
                const wheelGeometry = new THREE.CylinderGeometry(0.5, 0.5, 0.3, 16);
                const wheelMaterial = new THREE.MeshStandardMaterial({ color: 0x111111 });
                
                const wheelPositions = [
                    [-1.5, 0.5, -3],
                    [1.5, 0.5, -3],
                    [-1.5, 0.5, 2],
                    [1.5, 0.5, 2]
                ];

                wheelPositions.forEach(position => {
                    const wheel = new THREE.Mesh(wheelGeometry, wheelMaterial);
                    wheel.rotation.z = Math.PI / 2;
                    wheel.position.set(...position);
                    truck.add(wheel);
                });

                truck.position.set(10, 0, 8);
                this.scene.add(truck);
                return truck;
            }

            createProduct(type) {
                const productInfo = this.products[type];
                let geometry;
                
                switch(type) {
                    case 'wheel':
                        geometry = new THREE.TorusGeometry(0.5, 0.2, 16, 32);
                        break;
                    case 'door':
                        geometry = new THREE.BoxGeometry(1.5, 2, 0.1);
                        break;
                    case 'headlight':
                        geometry = new THREE.SphereGeometry(0.3, 16, 16);
                        break;
                    default:
                        geometry = new THREE.BoxGeometry(1, 1, 1);
                }

                const material = new THREE.MeshStandardMaterial({ color: productInfo.color });
                return new THREE.Mesh(geometry, material);
            }

            setupGUI() {
                const gui = new dat.GUI();
                
                const params = {
                    productType: 'wheel',
                    shelf: 0,
                    addProduct: () => this.addProductToShelf(),
                    loadinTruck: () => this.removeProductFromShelf(),
                    startTruck: () => this.startTruck()
                };

                gui.add(params, 'productType', Object.keys(this.products)).onChange(value => this.currentProductType = value);
                gui.add(params, 'shelf', { 'Shelf 1': 0, 'Shelf 2': 1, 'Shelf 3': 2 }).onChange(value => this.selectedShelf = value);
                gui.add(params, 'addProduct');
                gui.add(params, 'loadinTruck');
                gui.add(params, 'startTruck');
            }

            addProductToShelf() {
                const product = this.createProduct(this.currentProductType);
                product.position.set(0, 10, 0); // Start above the warehouse
                this.scene.add(product);

                const shelfPosition = this.shelves.children[this.selectedShelf].position.clone();
                shelfPosition.y += 2; // Adjust height to place on shelf

                new TWEEN.Tween(product.position)
                    .to({ x: shelfPosition.x, y: shelfPosition.y, z: shelfPosition.z }, 1000)
                    .easing(TWEEN.Easing.Quadratic.Out)
                    .start();

                if (!this.inventory.has(this.selectedShelf)) {
                    this.inventory.set(this.selectedShelf, []);
                }
                this.inventory.get(this.selectedShelf).push(product);
            }

            removeProductFromShelf() {
                const shelfProducts = this.inventory.get(this.selectedShelf);
                if (shelfProducts && shelfProducts.length > 0) {
                    const product = shelfProducts.pop();
                    new TWEEN.Tween(product.position)
                        .to({ x: 10, y: 2, z: 8 }, 1000) // Move to truck
                        .easing(TWEEN.Easing.Quadratic.Out)
                        .onComplete(() => this.scene.remove(product))
                        .start();
                }
            }

            startTruck() {
                const truckPosition = this.truck.position.clone();
                truckPosition.y += 2;

                new TWEEN.Tween(this.truck.position)
                    .to({ x: 20, y: 0, z: 8 }, 2000) // Move truck away
                    .easing(TWEEN.Easing.Quadratic.Out)
                    .onComplete(() => {
                        this.truck.position.set(10, 0, 8); // Reset truck position
                    })
                    .start();
            }

            animate() {
                requestAnimationFrame(() => this.animate());
                TWEEN.update();
                this.controls.update();
                this.renderer.render(this.scene, this.camera);
            }
        }

        // Initialize the simulation when the page loads
        window.addEventListener('DOMContentLoaded', () => {
            const simulation = new WarehouseSimulation();
        });

        // Handle window resizing
        window.addEventListener('resize', () => {
            simulation.camera.aspect = window.innerWidth / window.innerHeight;
            simulation.camera.updateProjectionMatrix();
            simulation.renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>